dnl tcpreplay configure script.
dnl $Id: configure.in,v 1.1 2002/03/29 03:44:52 mattbing Exp $

AC_INIT(tcpreplay.c)
AC_CONFIG_HEADER(config.h)

dnl Initialize prefix.
if test "$prefix" = "NONE"; then
	prefix="/usr/local"
fi

dnl Checks for programs.
AC_PROG_CC
AC_PROG_INSTALL
AC_PROG_MAKE_SET
AC_PROG_CPP
AC_FUNC_MEMCMP

dnl Enable debugging in code/compiler options
debug=no
AC_MSG_CHECKING(for debug enabled)
AC_ARG_WITH(debug,
[  --with-debug            Enable debugging code and support for the -d option],
[debug=yes AC_DEFINE(DEBUG) AC_MSG_RESULT(yes)], AC_MSG_RESULT(no))

dnl Use these compiler flags if we have gcc.
if test $ac_cv_prog_gcc = yes -a $debug = no; then
    CCOPTS='-O3 -pipe -Wall'
    CFLAGS="$CCOPTS"
else
	CCOPTS='-pipe -Wall -ggdb'
	CFLAGS="$CCOPTS"
fi

dnl Check for types.
AC_CHECK_TYPE(u_int8_t, uint8_t)
AC_CHECK_TYPE(u_int16_t, uint16_t)
AC_CHECK_TYPE(u_int32_t, uint32_t)
AC_CHECK_TYPE(u_int64_t, uint64_t)

dnl Checks for libraries.
AC_CHECK_LIB(socket, socket)
AC_CHECK_LIB(nsl, gethostbyname)
AC_CHECK_LIB(m, fmod, , AC_MSG_ERROR(libm not found))
AC_FUNC_MEMCMP

dnl Checks for header files.
AC_HEADER_STDC
AC_CHECK_HEADERS(err.h math.h sys/time.h signal.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_TYPE_SIZE_T
AC_HEADER_TIME

dnl Checks for library functions.
AC_CHECK_FUNCS(gettimeofday regcomp ctime)

dnl Check for err
neederr=no
AC_CHECK_FUNCS(warnx, , [neederr=yes])
if test $neederr = yes; then
	EXTRAS="$EXTRAS err.c"
fi
AC_SUBST(EXTRAS)

dnl Checks for libnet (shamelessly horked from dsniff)
AC_MSG_CHECKING(for libnet)
AC_ARG_WITH(libnet,
[  --with-libnet=DIR       use libnet in DIR],
[ case "$withval" in
  yes|no)
     AC_MSG_RESULT(no)
     ;;
  *)
     AC_MSG_RESULT($withval)
     if test -f $withval/include/libnet.h -a -f $withval/lib/libnet.a; then
        owd=`pwd`
        if cd $withval; then withval=`pwd`; cd $owd; fi
	if test -f $withval/bin/libnet-config; then
	   CFLAGS="$CFLAGS `$withval/bin/libnet-config --defines`"
	elif test -f $withval/libnet-config; then
	   CFLAGS="$CFLAGS `$withval/libnet-config --defines`"
	else
	   CFLAGS="$CFLAGS `libnet-config --defines`"
	fi
	LNETINC="-I$withval/include"
	LNETLIB="-L$withval/lib -lnet"
     else
        AC_ERROR(libnet.h or libnet.a not found in $withval)
     fi
     ;;
  esac ],
[ if test -f ${prefix}/include/libnet.h; then
     CFLAGS="$CFLAGS `${prefix}/bin/libnet-config --defines`"
     LNETINC="-I${prefix}/include"
     LNETLIB="-L${prefix}/lib -lnet"
  elif test -f /usr/include/libnet.h; then
     CFLAGS="$CFLAGS `libnet-config --defines`"
     LNETLIB="-lnet"
  else
     AC_MSG_RESULT(no)
     AC_ERROR(libnet not found)
  fi
  AC_MSG_RESULT(yes) ]
)
AC_SUBST(LNETINC)
AC_SUBST(LNETLIB)

AC_OUTPUT(Makefile)
