# $Id: Makefile.in,v 1.25 2002/11/20 06:11:19 aturner Exp $

PREFIX		= @prefix@
BINDIR		= $(PREFIX)/bin
SBINDIR		= $(PREFIX)/sbin
MAN8DIR		= $(PREFIX)/man/man8
MAN1DIR		= $(PREFIX)/man/man1

CC		= @CC@
CFLAGS		= @CFLAGS@
LDFLAGS		= @LDFLAGS@
DEFS		= @DEFS@
INCS		= @LNETINC@ -I. -Ilibredblack
LIBS		= @LIBS@ @LNETLIB@

INSTALL		= @INSTALL@

BINARIES	= tcpreplay capinfo tcpprep

TSRCS		= tcpreplay.c libpcap.c snoop.c timer.c cache.c cidr.c do_packets.c list.c xX.c err.c @EXTRAS@
TOBJS		= $(TSRCS:.c=.o)

CSRCS		= capinfo.c libpcap.c snoop.c timer.c err.c @EXTRAS@
COBJS		= $(CSRCS:.c=.o)

PSRCS		= tcpprep.c libpcap.c snoop.c cidr.c tree.c cache.c list.c xX.c err.c @EXTRAS@
POBJS		= $(PSRCS:.c=.o)

.c.o:
	$(CC) $(CFLAGS) $(INCS) -c $*.c

.PHONY: test

all: libredblack $(BINARIES) 

tcpprep: $(POBJS)
	$(CC) $(CFLAGS) $(DEFS) $(INCS) -o $@ $(POBJS) $(LDFLAGS) $(LIBS) libredblack/.libs/libredblack.a

tcpreplay: $(TOBJS)
	$(CC) $(CFLAGS) $(DEFS) $(INCS) -o $@ $(TOBJS) $(LDFLAGS) $(LIBS)

capinfo: $(COBJS)
	$(CC) $(CFLAGS) $(DEFS) $(INCS) -o $@ $(COBJS) $(LDFLAGS) $(LIBS)

libredblack: libredblack/.libs/libredblack.a

libredblack/.libs/libredblack.a:
	cd libredblack && sh ./configure && make

clean:
	-rm -f *.o *core $(BINARIES)
	-cd libredblack && make distclean
	-cd test && make clean

distclean: clean
	-rm -rf autom4te-2.??.cache
	-rm -f Makefile config.h config.status config.cache config.log *~
	-cd test && make distclean

install: 
	test -d $(SBINDIR) || $(INSTALL) -d $(SBINDIR)
	test -d $(BINDIR) || $(INSTALL) -d $(BINDIR)
	test -d $(MAN8DIR) || $(INSTALL) -d $(MAN8DIR)
	test -d $(MAN1DIR) || $(INSTALL) -d $(MAN1DIR)
	$(INSTALL) -m 755 tcpreplay $(SBINDIR)
	$(INSTALL) -m 755 capinfo $(BINDIR)
	$(INSTALL) -m 755 tcpprep $(BINDIR)
	$(INSTALL) -m 644 tcpreplay.8 $(MAN8DIR)
	$(INSTALL) -m 644 capinfo.1 $(MAN1DIR)
	$(INSTALL) -m 644 tcpprep.1 $(MAN1DIR)

uninstall:
	rm -f $(SBINDIR)/tcpreplay
	rm -f $(MAN8DIR)/tcpreplay.8
	rm -f $(BINDIR)/capinfo
	rm -f $(MAN1DIR)/capinfo.1
	rm -f $(BINDIR)/tcpprep
	rm -f $(MAN1DIR)/tcpprep.1

pretty:
	indent -br -brs -di24 -ts4 -ncdw -nce -ncs -npcs -nprs -bfda -l80 -lc80 -lp -psl -i4 *.c *.h

test:
	cd test && make
